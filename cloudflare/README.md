# PokerPhase Cloudflare - Workers + Durable Objects ç‰ˆæœ¬

é€™æ˜¯ PokerPhase çš„å…¨çƒé‚Šç·£éƒ¨ç½²ç‰ˆæœ¬ï¼Œä½¿ç”¨ Cloudflare Workers å’Œ WebSocket å³æ™‚åŒæ­¥ã€‚

## ğŸ¯ é©ç”¨å ´æ™¯

- **å…¨çƒåœ˜éšŠå”ä½œ**ï¼š<50ms å…¨çƒå»¶é²
- **é«˜ä½µç™¼éœ€æ±‚**ï¼šè‡ªå‹•ç„¡é™æ“´å±•
- **å³æ™‚åŒæ­¥**ï¼šWebSocket é›¶å»¶é²é«”é©—
- **ç„¡ç¶­è­·éƒ¨ç½²**ï¼šå®Œå…¨ Serverless æ¶æ§‹

## ğŸš€ å¿«é€Ÿé–‹å§‹

### å‰ç½®éœ€æ±‚

1. **Cloudflare å¸³è™Ÿ**ï¼šè¨»å†Šå…è²»å¸³è™Ÿ
2. **Workers ä»˜è²»æ–¹æ¡ˆ**ï¼š$5/æœˆï¼ˆæ”¯æ´ Durable Objectsï¼‰
3. **Wrangler CLI**ï¼šCloudflare å®˜æ–¹å·¥å…·

### æœ¬åœ°é–‹ç™¼

1. **å®‰è£ä¾è³´**
   ```bash
   npm install
   ```

2. **ç™»å…¥ Cloudflare**
   ```bash
   npx wrangler login
   ```

3. **å•Ÿå‹•é–‹ç™¼æœå‹™å™¨**
   ```bash
   npm run dev
   ```

4. **è¨ªå•æ‡‰ç”¨**
   ```
   http://localhost:8787
   ```

### éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ

1. **é è¦½éƒ¨ç½²**
   ```bash
   npm run preview
   ```

2. **æ­£å¼éƒ¨ç½²**
   ```bash
   npm run deploy
   ```

3. **æŸ¥çœ‹å³æ™‚æ—¥èªŒ**
   ```bash
   npm run tail
   ```

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

### å¾Œç«¯
- **Cloudflare Workers**ï¼šé‚Šç·£é‹ç®—ç’°å¢ƒ
- **Durable Objects**ï¼šåˆ†æ•£å¼ç‹€æ…‹ç®¡ç†
- **WebSocket**ï¼šé›™å‘å³æ™‚é€šè¨Š

### å‰ç«¯
- **WebSocket Client**ï¼šå³æ™‚ç‹€æ…‹åŒæ­¥
- **è‡ªå‹•é‡é€£**ï¼šç¶²è·¯ä¸­æ–·è‡ªå‹•æ¢å¾©
- **å„ªé›…é™ç´š**ï¼šWebSocket å¤±æ•—æ™‚å›é€€ HTTP

### è³‡æ–™æµç¨‹
```
å…¨çƒç”¨æˆ¶ â†” WebSocket â†” Edge Worker â†” Durable Object
    â†“                      â†“              â†“
ä½å»¶é²å­˜å–           è·¯ç”±èˆ‡å¿«å–        æŒä¹…åŒ–ç‹€æ…‹
```

## ğŸ“ æª”æ¡ˆçµæ§‹

```
cloudflare/
â”œâ”€â”€ src/                    # Worker åŸå§‹ç¢¼
â”‚   â”œâ”€â”€ index.js           # ä¸»è¦å…¥å£é»
â”‚   â””â”€â”€ room.js            # Durable Object
â”œâ”€â”€ public/                # å‰ç«¯è³‡æº
â”‚   â”œâ”€â”€ index.html        # WebSocket ç‰ˆæœ¬
â”‚   â”œâ”€â”€ script.js         # WebSocket å®¢æˆ¶ç«¯
â”‚   â””â”€â”€ style.css         # æ¨£å¼æª”æ¡ˆ
â”œâ”€â”€ scripts/               # å·¥å…·è…³æœ¬
â”‚   â”œâ”€â”€ test-deployment.js
â”‚   â””â”€â”€ upload-assets.js
â”œâ”€â”€ wrangler.toml         # Cloudflare é…ç½®
â”œâ”€â”€ package.json          # ä¾è³´ç®¡ç†
â””â”€â”€ README.md             # èªªæ˜æ–‡ä»¶
```

## âš¡ æ•ˆèƒ½å„ªå‹¢

### ğŸŒ å…¨çƒé‚Šç·£éƒ¨ç½²
- **300+ æ•¸æ“šä¸­å¿ƒ**ï¼šè¦†è“‹å…¨çƒ
- **æ™ºèƒ½è·¯ç”±**ï¼šè‡ªå‹•é¸æ“‡æœ€è¿‘ç¯€é»
- **CDN æ•´åˆ**ï¼šéœæ…‹è³‡æºè¶…å¿«è¼‰å…¥

### ğŸ”„ å³æ™‚åŒæ­¥
- **WebSocket é€£ç·š**ï¼šæ¯«ç§’ç´šç‹€æ…‹æ›´æ–°
- **è‡ªå‹•é‡é€£**ï¼šç¶²è·¯æ¢å¾©å¾Œè‡ªå‹•é€£æ¥
- **å¿ƒè·³æª¢æ¸¬**ï¼šç¢ºä¿é€£ç·šç©©å®šæ€§

### ğŸ“ˆ è‡ªå‹•æ“´å±•
- **é›¶é…ç½®æ“´å±•**ï¼šè‡ªå‹•è™•ç†æµé‡å°–å³°
- **ç„¡å†·å•Ÿå‹•**ï¼šEdge Workers ç¬é–“éŸ¿æ‡‰
- **è³‡æºéš”é›¢**ï¼šæ¯å€‹æˆ¿é–“ç¨ç«‹ Durable Object

## ğŸ’° æˆæœ¬çµæ§‹

### Cloudflare Workers å®šåƒ¹
- **å…è²»é¡åº¦**ï¼š100,000 requests/day
- **ä»˜è²»æ–¹æ¡ˆ**ï¼š$5/month + ä½¿ç”¨é‡
- **Durable Objects**ï¼š$0.15/GB storage

### å¯¦éš›ä½¿ç”¨æˆæœ¬
- **å°å‹åœ˜éšŠ (5-10äºº)**ï¼š$5-10/æœˆ
- **ä¸­å‹çµ„ç¹” (50-100äºº)**ï¼š$20-50/æœˆ
- **å¤§å‹ä¼æ¥­ (500+äºº)**ï¼š$100-300/æœˆ

## ğŸ”§ é…ç½®é¸é …

### wrangler.toml
```toml
name = "pokerphase"
main = "src/index.js"
compatibility_date = "2024-01-01"

[[durable_objects.bindings]]
name = "ROOM"
class_name = "Room"
```

### ç’°å¢ƒè®Šæ•¸
- `ENVIRONMENT`ï¼šéƒ¨ç½²ç’°å¢ƒ
- `DEBUG_MODE`ï¼šèª¿è©¦æ¨¡å¼

## ğŸ› ï¸ é–‹ç™¼å·¥å…·

### æœ¬åœ°èª¿è©¦
```bash
npm run dev          # æœ¬åœ°é–‹ç™¼æœå‹™å™¨
npm run tail         # æŸ¥çœ‹å³æ™‚æ—¥èªŒ
npm run test         # é‹è¡Œæ¸¬è©¦å¥—ä»¶
```

### éƒ¨ç½²ç®¡ç†
```bash
npm run preview      # é è¦½ç’°å¢ƒéƒ¨ç½²
npm run deploy       # ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²
wrangler rollback    # å›æ»¾éƒ¨ç½²
```

## ğŸ” ç›£æ§èˆ‡æ—¥èªŒ

### Cloudflare Dashboard
- **å³æ™‚æµé‡**ï¼šè«‹æ±‚æ•¸é‡å’Œå»¶é²
- **éŒ¯èª¤è¿½è¹¤**ï¼šç•°å¸¸å’Œæ•…éšœåˆ†æ
- **æ•ˆèƒ½æŒ‡æ¨™**ï¼šå›æ‡‰æ™‚é–“åˆ†å¸ƒ

### æ—¥èªŒæŸ¥çœ‹
```bash
# å³æ™‚æ—¥èªŒ
npm run tail

# ç‰¹å®šæ™‚é–“ç¯„åœ
wrangler tail --since=1h

# éæ¿¾æ¢ä»¶
wrangler tail --grep="ERROR"
```

## ğŸ†š vs Traditional ç‰ˆæœ¬

| ç‰¹è‰² | Cloudflare | Traditional |
|------|------------|-------------|
| å»¶é² | <50ms å…¨çƒ | ä¾ä¼ºæœå™¨ä½ç½® |
| åŒæ­¥æ–¹å¼ | WebSocket | HTTP è¼ªè©¢ |
| æ“´å±•æ€§ | è‡ªå‹•ç„¡é™ | æ‰‹å‹•æ“´å±• |
| ç¶­è­·æˆæœ¬ | é›¶ç¶­è­· | éœ€è¦ç®¡ç† |
| é›¢ç·šæ”¯æ´ | âŒ | âœ… |
| è¤‡é›œåº¦ | ä¸­ç­‰ | ç°¡å–® |

## ğŸš¨ æ³¨æ„äº‹é …

1. **ä»˜è²»éœ€æ±‚**ï¼šDurable Objects éœ€è¦ä»˜è²»æ–¹æ¡ˆ
2. **å­¸ç¿’æ›²ç·š**ï¼šéœ€è¦äº†è§£ Cloudflare ç”Ÿæ…‹ç³»çµ±
3. **é™¤éŒ¯å·®ç•°**ï¼šèˆ‡å‚³çµ± Node.js ç’°å¢ƒä¸åŒ
4. **ç¶²è·¯ä¾è³´**ï¼šå¿…é ˆæœ‰ç¶²è·¯é€£ç·š

## ğŸ“ æ”¯æ´

- æŸ¥çœ‹ [Cloudflare Workers æ–‡ä»¶](https://developers.cloudflare.com/workers/)
- åƒè€ƒ [Durable Objects æŒ‡å—](https://developers.cloudflare.com/workers/learning/using-durable-objects/)
- å¦‚éœ€ç°¡å–®éƒ¨ç½²ï¼Œè«‹ä½¿ç”¨ Traditional ç‰ˆæœ¬